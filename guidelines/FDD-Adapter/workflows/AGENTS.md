# Workflow Instructions for Hyperspot

<!-- 
⚠️ AI AGENT NOTICE: This file was generated by workflow adapter-config-from-code.
If user wants to modify this adapter, run workflow adapter-config again or edit manually with caution.
Manual edits may be overwritten if workflow is re-run.
-->

**Extends**: `../../FDD/workflows/AGENTS.md`

---

## Pre-Workflow Checks

- [ ] Rust toolchain installed (edition 2021)
- [ ] Cargo available
- [ ] GTS specification readable at `guidelines/GTS/`
- [ ] Project compiles: `cargo check --workspace`

---

## Validation Commands

### Domain Model Validation

**GTS Type Validation**:
```bash
# Validate GTS identifiers and JSON schemas
cargo test --package types-registry --lib

# Run GTS-specific lints
cd dylint_lints && cargo build --release
cargo dylint --workspace de0901_gts_string_pattern de0902_no_schema_for_on_gts_structs
```

**Type System Checks**:
```bash
# Verify no type redefinition across modules
# Check contract layer purity (no serde, HTTP types)
cargo dylint --workspace de0101_no_serde_in_contract de0103_no_http_types_in_contract
```

### API Contracts Validation

**OpenAPI Validation**:
```bash
# Start server and fetch OpenAPI spec
cargo run --package hyperspot-server &
sleep 5
curl http://localhost:8087/openapi.json > docs/api/api.json
# Validate with: make openapi-fetch
```

**gRPC Validation**:
```bash
# Protocol buffer compilation (happens automatically during build)
cargo build --workspace
# gRPC contracts validated at compile time via tonic-build
```

### Architectural Validation

**Layer Separation**:
```bash
# Validate architectural conventions
make dylint
# Runs all custom lints including:
# - DTO placement and isolation
# - Contract layer purity
# - API endpoint versioning
# - GTS identifier format
```

### Full Project Validation

**Complete Safety Checks**:
```bash
# Format check
cargo fmt --all -- --check

# Lint check
make clippy

# Custom architectural lints
make dylint

# Compile warnings as errors
make lint

# Run all tests
cargo test --workspace --all-features

# Optional: Unsafe code audit
make geiger
```

---

## Build and Test Commands

**Development**:
```bash
# Build all modules
cargo build --workspace

# Run server
cargo run --package hyperspot-server

# Run specific module
cargo run --package <module-name>
```

**Testing**:
```bash
# All tests
cargo test --workspace --all-features

# Specific module tests
cargo test --package <module-name>

# Integration tests
cargo test --test '*' --workspace
```

**Quality Checks**:
```bash
# Quick validation (format + clippy + dylint)
cargo fmt --all -- --check && make clippy && make dylint

# Full validation
make lint && cargo test --workspace
```

---

## Project-Specific Conventions

### Modkit Architecture

All modules follow strict layer separation:
- **contracts** (`-contracts` crate): Pure domain types, GTS structs
- **sdk** (`-sdk` crate): Client interfaces, contracts re-exports
- **main** (module crate): Domain logic, API implementations, infrastructure

### GTS Usage

- All domain types use GTS identifiers
- Format: `gts.ainetx.hyperspot.<namespace>.<type>.v<version>`
- Validation enforced by `de0901_gts_string_pattern` lint
- Registration in `modules/types-registry/`

### API Conventions

- REST endpoints: `/api/v<N>/<resource>`
- Enforced by `de0801_api_endpoint_version` lint
- DTOs only in `api/rest/dto.rs` or `api/grpc/dto.rs`
- OpenAPI docs via utoipa macros

### Error Handling

- Use `modkit-errors` catalog system
- GTS-based error type identifiers
- Problem Details (RFC 7807) format for HTTP errors

---

## References

- **Core Workflows**: `../../FDD/workflows/AGENTS.md`
- **Adapter**: `../AGENTS.md`
- **FDD Core**: `../../FDD/AGENTS.md`
- **Architecture**: `../../../docs/ARCHITECTURE_MANIFEST.md`
- **Modkit System**: `../../../docs/MODKIT_UNIFIED_SYSTEM.md`
- **GTS Spec**: `../../GTS/README.md`
