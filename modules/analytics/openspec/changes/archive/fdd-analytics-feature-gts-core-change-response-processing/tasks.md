# Implementation Tasks

## 1. Implementation

- [x] 1.1 Create field categorization system (client-provided, server-managed, computed, secrets)
- [x] 1.2 Implement Tolerant Reader pattern for request processing
- [x] 1.3 Implement field filtering for response processing (remove secrets)
- [x] 1.4 Implement computed field injection on read operations
- [x] 1.5 Implement system field protection (ignore id, type, tenant in requests)
- [x] 1.6 Implement JSON Patch path validation (restrict to /entity/*)
- [x] 1.7 Integrate with OData $select parameter for field projection)

## 2. Testing

### Unit Tests (from Section F)

- [x] 2.1 Implement test: Client Cannot Override System Fields
  - Test steps:
    1. Create POST request with id, type, tenant in body
    2. Process request through Tolerant Reader
    3. Verify system fields ignored and generated by server
    4. Verify client values discarded
    5. Test with PUT request as well

- [x] 2.2 Implement test: Secrets Not Returned
  - Test steps:
    1. Create entity with API key in entity object
    2. Send GET request for entity
    3. Process response through field filter
    4. Verify response omits sensitive fields (API keys, credentials)
    5. Verify other fields present

- [x] 2.3 Implement test: PATCH Operations Restricted
  - Test steps:
    1. Create PATCH request attempting to modify /id
    2. Create PATCH request attempting to modify /type
    3. Validate patch operations
    4. Verify requests rejected with HTTP 400
    5. Verify only /entity/* paths allowed in JSON Patch

- [x] 2.4 Implement test: Computed Fields Added on Read
  - Test steps:
    1. Create entity without asset_path
    2. Send GET request
    3. Process response through computed field injector
    4. Verify asset_path computed and added by server
    5. Verify other computed fields added

### Integration Tests

- [x] 2.5 Implement test: End-to-End Create with System Fields
  - Test steps:
    1. POST entity with client attempt to set id, type, tenant
    2. Verify request passes middleware
    3. Verify Tolerant Reader ignores system fields
    4. Verify response includes server-generated values
    5. Verify client values not persisted

- [x] 2.6 Implement test: End-to-End Read with Secrets
  - Test steps:
    1. Store entity with API key
    2. Send GET request
    3. Verify response excludes secrets
    4. Verify non-sensitive fields present

- [x] 2.7 Implement test: End-to-End PATCH with Path Validation
  - Test steps:
    1. PATCH /entity/name → success
    2. PATCH /id → HTTP 400
    3. PATCH /type → HTTP 400
    4. Verify only entity paths allowed

### Edge Case Tests

- [x] 2.8 Test field projection with $select parameter
- [x] 2.9 Test nested field filtering (entity/credentials/api_key)
- [x] 2.10 Test computed fields with missing dependencies
- [x] 2.11 Test PATCH with mixed valid/invalid paths

### Validation

- [x] 2.12 Validate implementation matches Section C Algorithm 3 (Tolerant Reader Pattern)
- [x] 2.13 Validate implementation matches Section E (Tolerant Reader Pattern)
- [x] 2.14 Validate field categories cover all use cases
- [x] 2.15 Run `cargo check --package analytics` to verify compilation
- [x] 2.16 Run `cargo test --package analytics --lib` to verify all tests pass
