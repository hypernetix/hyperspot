services:
  mock:
    build:
      context: ..
      dockerfile: docker/http-mock.Dockerfile
    ports:
      - "18080:8080"  # Optional host access
    healthcheck:
      test: [ "CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8080/ping')" ]
      interval: 5s
      timeout: 3s
      retries: 3
      start_period: 5s

  file_parser_api:
    image: hyperspot-api:e2e
    build:
      context: ../..
      dockerfile: hyperspot.Dockerfile
    ports:
      - "8087:8087"
    extra_hosts:
      # Allow container to access host machine via host.docker.internal
      - "host.docker.internal:host-gateway"
    environment:
      # No external dependencies needed for file_parser module
      - RUST_LOG=info
      - APP__MODULES__api_gateway__CONFIG__BIND_ADDR=0.0.0.0:8087
      - APP__MODULES__api_gateway__CONFIG__ENABLE_DOCS=true
      - APP__MODULES__api_gateway__CONFIG__CORS_ENABLED=true
    depends_on:
      mock:
        condition: service_healthy
    # No external dependencies required for file_parser module
    # (file_parser doesn't need Postgres, MinIO, etc.)
    # Readiness is checked by the Makefile e2e target

