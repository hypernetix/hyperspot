services:
  mock:
    build:
      context: ..
      dockerfile: docker/http-mock.Dockerfile
    ports:
      - "18080:8080"  # Optional host access
    healthcheck:
      test: [ "CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8080/ping')" ]
      interval: 5s
      timeout: 3s
      retries: 3
      start_period: 5s

  file-parser-api:
    image: hyperspot-api:e2e
    build:
      context: ../..
      dockerfile: testing/docker/hyperspot.Dockerfile
    ports:
      - "8086:8086"
    extra_hosts:
      # Allow container to access host machine via host.docker.internal
      - "host.docker.internal:host-gateway"
    environment:
      # No external dependencies needed for file-parser module
      - RUST_LOG=info
    depends_on:
      mock:
        condition: service_healthy
    # No external dependencies required for file-parser module
    # (file-parser doesn't need Postgres, MinIO, etc.)
    # Readiness is checked by the Makefile e2e target

